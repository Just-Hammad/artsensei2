<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ArtSensei</title>
    <link rel="icon" type="image/x-icon" href="../Cathy.ico">
    <link rel="preload" href="../css/styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="../css/styles.css"></noscript>
    <style>
        body {
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            font-family: 'Poppins', sans-serif;
            background-color: #212121;
        }

        .container {
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        #modelContainer {
            width: 100%;
            height: 50vh;
            position: relative;
            background-color: #212121;
        }

        #modelCanvas {
            width: 100%;
            height: 100%;
        }

        .chat-container {
            width: 100%;
            height: 50vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h2 {
            margin: 10px 0;
            font-size: 2rem;
            font-weight: bold;
            text-align: center;
            color: #b3b3b3;
        }

        .subtext {
            font-size: 1.1rem;
            color: #b3b3b3;
            font-weight: normal;
            text-align: center;
            margin: 5px 0;
        }

        #logContainer {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="modelContainer">
            <canvas id="modelCanvas"></canvas>
        </div>
        
        <div class="chat-container">
            <h2 id="senseiName"></h2>
            <input type="hidden" id="voiceId" value="F0yTXVI2WXEIiShs00dR">
            <p class="subtext">Are you ready, Logan? Tap the button :)</p>
            <div id="logContainer"></div>
        </div>
    </div>

    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
        }
    }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // Scene setup
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x212121);

        // Camera setup
        const canvas = document.getElementById('modelCanvas');
        const camera = new THREE.PerspectiveCamera(75, canvas.clientWidth / canvas.clientHeight, 0.1, 1000);
        camera.position.z = 5;

        // Renderer setup
        const renderer = new THREE.WebGLRenderer({ 
            canvas,
            antialias: true 
        });
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(canvas.clientWidth, canvas.clientHeight);
        
        // Add lights
        const ambientLight = new THREE.AmbientLight(0xffffff, 1);
        scene.add(ambientLight);

        const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
        directionalLight.position.set(2, 2, 5);
        scene.add(directionalLight);

        // Add OrbitControls
        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;

        // Load the model
        const loader = new GLTFLoader();
        loader.load(
            '../3DModels/human_head.glb',
            function(gltf) {
                const model = gltf.scene;
                model.scale.set(2, 2, 2);
                model.position.set(0, 0, 0);
                scene.add(model);

                // Center the model
                const box = new THREE.Box3().setFromObject(model);
                const center = box.getCenter(new THREE.Vector3());
                model.position.sub(center);

                // Adjust camera to fit model
                const size = box.getSize(new THREE.Vector3());
                const maxDim = Math.max(size.x, size.y, size.z);
                const fov = camera.fov * (Math.PI / 180);
                const cameraZ = Math.abs(maxDim / Math.tan(fov / 2)) * 1.5;
                camera.position.z = cameraZ;
                camera.updateProjectionMatrix();

                controls.target.set(0, 0, 0);
                controls.update();
            },
            undefined,
            function(error) {
                console.error('Error loading model:', error);
            }
        );

        // Animation loop
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
        animate();

        // Handle window resizing
        window.addEventListener('resize', () => {
            const container = document.getElementById('modelContainer');
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        });
    </script>

    <script type="module">
        const name = "Gollum";
        const src = 'https://cdn.jsdelivr.net/gh/Just-Hammad/artsensei2@8b1fcc263558667375036d20b9a9d44a60f79112/avatar/Gollum.webp';
        
        document.getElementById("senseiName").textContent = name;
        
        import Chatbot from "https://cdn.jsdelivr.net/gh/Just-Hammad/artsensei2@8ea1acf3f2ecd92f082d726fcd9b629fdd8496ba/js/webmin.js";
        Chatbot.init({
            chatflowid: "c1058d7a-ed52-42ab-b5c9-a38bd181eb89",
            apiHost: "https://chat.artsensei.ai",
            theme: {
                chatWindow: {
                    showTitle: true,
                    title: name,
                    titleAvatarSrc: src,
                    showAgentMessages: false,
                    welcomeMessage: `Hi, Logan! Let's do this!`,
                    errorMessage: 'Error: Please contact teacher',
                    backgroundColor: "#212121",
                    height: '100%',
                    width: '100%',
                    fontSize: 16,
                    poweredByTextColor: "#b3b3b3",
                    botMessage: {
                        backgroundColor: "#212121",
                        textColor: "#b3b3b3",
                        showAvatar: true,
                        avatarSrc: src,
                        maxWidth: '100%',
                        marginRight: '60px',
                    },
                    userMessage: {
                        backgroundColor: "#333333",
                        textColor: "#ffffff",
                        showAvatar: false,
                        avatarSrc: "https://raw.githubusercontent.com/zahidkhawaja/langchain-chat-nextjs/main/public/usericon.png",
                    },
                    textInput: {
                        placeholder: 'Type your question',
                        backgroundColor: '#212121',
                        textColor: '#b3b3b3',
                        sendButtonColor: '#3B81F6',
                        maxChars: 300,
                        maxCharsWarningMessage: 'You exceeded the characters limit. Please input less than 300 characters.',
                        autoFocus: true,
                        width: '100%',
                        boxSizing: 'border-box',
                    },
                    feedback: {
                        color: '#b3b3b3',
                    },
                    footer: {
                        textColor: '#b3b3b3',
                        text: 'Powered by',
                        company: 'Artsensei',
                        companyLink: 'https://artsensei.ai',
                    }
                }
            }
        });
    </script>
    
    <script src="../js/log-errors.js" defer></script>
    <script src="../js/override-chatbot-styles.js" defer></script>
    <script src="../js/tts-service.js" defer></script>
</body>
</html>